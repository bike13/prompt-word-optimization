<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>🚀 提示词优化器</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/github-markdown-css/github-markdown-light.css"
    />
    <style>
      /* 全局重置和基础样式 */
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      [v-cloak] {
        display: none !important;
      }

      html {
        padding: 0;
        margin: 0;
      }

      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      h1,
      h2,
      h3,
      label {
        user-select: none;
      }

      a {
        color: #667eea;
        text-decoration: none;
      }

      a + a {
        margin-left: 12px;
      }

      .ellipsis2 {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        line-clamp: 2;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      /* 布局容器和结构 */
      .container {
        max-width: 1440px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .main-content {
        display: flex;
        min-height: calc(100vh - 40px - 120px);
      }

      .left-panel {
        flex: 1;
        position: relative;
        max-width: 33.33%;
        padding: 20px;
        border-right: 1px solid #e0e0e0;
        background-color: #fafafa;
      }

      .right-panel {
        flex: 2;
        max-width: 66.67%;
        position: relative;
        display: flex;
        flex-direction: column;
      }

      /* 头部区域 */
      .header {
        position: relative;
        height: 120px;
        padding: 20px 12px 0;
        text-align: center;
        color: white;
        background: linear-gradient(160deg, #0a0a2e, #16213e, #3b108b, #b83dba);
      }

      .header h1 {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 2px 0 0;
        padding: 0;
        font-size: 2rem;
        z-index: 1;
      }

      .header h1 small {
        display: inline-block;
        margin-top: -0.3em;
        margin-left: 0.7em;
        font-size: 0.7em;
        animation: breath 3s infinite;
        cursor: pointer;
        user-select: none;
      }

      .header p {
        position: relative;
        margin: 12px 0 0;
        font-size: 0.92em;
        user-select: none;
        z-index: 1;
      }

      /* 星星背景装饰 */
      .stars {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
      }

      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle 2s infinite;
      }

      .star:nth-child(1) {
        width: 2px;
        height: 2px;
        top: 20%;
        left: 10%;
        animation-delay: 0s;
      }

      .star:nth-child(2) {
        width: 1px;
        height: 1px;
        top: 30%;
        left: 80%;
        animation-delay: 0.5s;
      }

      .star:nth-child(3) {
        width: 2px;
        height: 2px;
        top: 60%;
        left: 20%;
        animation-delay: 1s;
      }

      .star:nth-child(4) {
        width: 2px;
        height: 2px;
        top: 88%;
        left: 70%;
        animation-delay: 1.5s;
      }

      .star:nth-child(5) {
        width: 2px;
        height: 2px;
        top: 12%;
        left: 60%;
        animation-delay: 0.8s;
      }

      /* 流星效果 */
      .meteor {
        position: absolute;
        z-index: 0;
        width: 4px;
        height: 4px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 10px #fff, 0 0 20px #fff;
        animation: meteor-move 2s linear infinite;
        opacity: 0;
      }

      .meteor::before {
        content: '';
        position: absolute;
        width: 60px;
        height: 2px;
        top: 0;
        bottom: 0;
        left: 2px;
        margin: auto 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transform: translate(-100% -100%);
        border-radius: 1px;
      }

      /* 第一颗流星 - 右 */
      .meteor:nth-child(1) {
        top: -1%;
        right: 5%;
        animation-delay: 4s;
        animation-duration: 8.2s;
      }

      .meteor:nth-child(1)::before {
        width: 70px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0.5),
          rgba(255, 255, 255, 0.1),
          transparent
        );
      }

      /* 第二颗流星 - 中 */
      .meteor:nth-child(2) {
        top: -1%;
        right: 40%;
        animation-delay: 7s;
        animation-duration: 11.9s;
      }

      .meteor:nth-child(2)::before {
        width: 80px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.8),
          rgba(255, 255, 255, 0.4),
          rgba(255, 255, 255, 0.1),
          transparent
        );
      }

      /* 第三颗流星 - 左 */
      .meteor:nth-child(3) {
        top: -1%;
        right: 82%;
        animation-delay: 3s;
        animation-duration: 9.4s;
      }

      .meteor:nth-child(3)::before {
        width: 65px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.85),
          rgba(255, 255, 255, 0.45),
          rgba(255, 255, 255, 0.15),
          transparent
        );
      }

      /* 结果区域和优化区域 */
      .result-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        padding: 20px;
        border-bottom: 4px solid #e0e0e0;
        background-color: #fff;
      }

      .optimization-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        padding: 20px;
        background-color: #fff;
      }

      .section-header {
        flex: 0 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
        padding-bottom: 10px;
        user-select: none;
      }

      .section-title {
        margin: 0;
        color: #333;
        font-size: 1.1em;
      }

      .result-content {
        flex: 1 1 0;
        position: relative;
        min-height: 173px;
        padding-top: 20px;
        line-height: 1.6;
        border-top: 2px solid #e0e0e0;
        color: #333;
        overflow-x: hidden;
        overflow-y: auto;
        transition: all 0.2s;
      }

      .result-content div * {
        user-select: text;
      }

      .result-content h1,
      .result-content h2,
      .result-content h3 {
        color: #667eea;
        margin-top: 0;
      }

      .result-content pre {
        position: relative;
        max-width: 100%;
        border-radius: 6px;
        padding: 15px;
        background: #f4f4f4;
      }

      .result-content code {
        display: inline-block !important;
        max-width: 100%;
        padding: 2px 4px;
        white-space: pre-wrap !important;
        word-break: break-all !important;
        border-radius: 3px;
        background: #f4f4f4;
        font-family: 'Courier New', monospace;
      }

      .markdown-body {
        background: none;
        white-space-collapse: collapse;
      }

      /* 文本输入区域 */
      .textarea-container {
        position: relative;
        margin-bottom: 20px;
      }

      .textarea-container label {
        display: block;
        margin: 0 0 10px;
        color: #333;
        font-size: 1.1em;
        font-family: Arial, sans-serif;
      }

      .textarea-container textarea {
        width: 100%;
        min-height: 250px;
        max-height: 35em;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 6px;
        background: #fff;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        resize: vertical;
        transition: border-color 0.3s;
      }

      .textarea-container textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .textarea-container textarea.completing {
        animation: blink 1s infinite;
      }

      /* 图标区域 */
      .icons {
        position: absolute;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 0.6em;
        flex-wrap: nowrap;
        top: 0px;
        right: 2px;
        width: 6.5em;
        height: 1.5em;
      }

      .icons > * {
        width: 1.5em;
        height: 1.5em;
        line-height: 1.5em;
        text-align: center;
        font-size: 1.1em;
        border-radius: 4px;
        user-select: none;
        cursor: pointer;
      }

      .icons > *:hover {
        background: rgba(102, 126, 234, 0.3);
      }

      /* 复选框组 */
      .checkbox-group {
        margin-bottom: 20px;
      }

      .checkbox-group h3 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        color: #333;
        font-size: 1.1rem;
      }

      .checkbox-container {
        position: relative;
        display: flex;
        align-items: flex-start;
        flex-wrap: wrap;
        padding: 10px;
        overflow-x: hidden;
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        background: white;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        width: 50%;
        margin: 2px 0;
        padding: 4px;
        white-space: nowrap;
      }

      .checkbox-item input[type='checkbox'] {
        margin-right: 8px;
      }

      .checkbox-item label {
        font-size: 13px;
        cursor: pointer;
        user-select: none;
      }

      /* 自定义维度样式 */
      .custom-dimension-item {
        width: 100% !important;
        align-items: center;
        margin-top: 8px;
        padding-top: 12px;
        border-top: 1px dashed #ddd;
      }

      .custom-dimension-input {
        flex: 1;
        margin-left: 8px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 3px;
        font-size: 13px;
        outline: none;
        transition: border-color 0.3s;
      }

      .custom-dimension-input:focus {
        border-color: #667eea;
      }

      .custom-dimension-input::placeholder {
        color: #999;
        font-style: italic;
      }

      /* 按钮组 */
      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .btn {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 12px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s;
        text-transform: uppercase;
        user-select: none;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
      }

      .btn-default {
        background: #fff;
        border: 2px dashed #28a745;
        color: #28a745;
      }

      .btn-default:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
      }

      .clear-btn {
        padding: 6px 10px;
        background: rgb(227, 103, 89);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.3s;
      }

      .clear-btn:hover {
        background: rgb(207, 83, 69);
      }

      .copy-btn {
        padding: 6px 10px;
        margin-left: 8px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.3s;
      }

      .copy-btn:hover {
        background: #218838;
      }

      /* 状态和交互样式 */
      .btn.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .icon-complete.busy {
        background: none !important;
        animation: twist 1.75s ease-out infinite;
      }

      .rocket {
        display: inline-block;
        margin-right: 0.35em;
        animation: rocket-tremble 2.15s ease-in-out infinite;
        transform-origin: center;
        cursor: pointer;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
      }

      .empty-state {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        padding: 50px 20px;
        text-align: center;
        color: #666;
        font-style: italic;
        white-space: pre-wrap;
        user-select: none !important;
        border-radius: 6px;
        overflow: hidden;
      }

      .empty-state.generating {
        background: #e9e9e9;
      }

      .empty-state span {
        position: relative;
        z-index: 1;
        user-select: none !important;
      }

      .generating::before {
        content: '';
        position: absolute;
        top: 0;
        left: -20px;
        width: calc(100% + 40px);
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent 25%,
          rgba(255, 255, 255, 0.3) 25%,
          rgba(255, 255, 255, 0.3) 50%,
          transparent 50%,
          transparent 75%,
          rgba(255, 255, 255, 0.3) 75%
        );
        background-size: 20px 20px;
        animation: slide 1s linear infinite;
      }

      /* 动画和关键帧 */
      @keyframes twist {
        0%,
        50%,
        100% {
          transform: scaleX(1);
        }

        25%,
        75% {
          transform: scaleX(-1);
        }
      }

      @keyframes blink {
        0%,
        100% {
          background: #fff;
        }

        50% {
          background: rgba(102, 126, 234, 0.2);
        }
      }

      @keyframes meteor-move {
        0%,
        100% {
          transform: translateX(0) translateY(0) rotate(-45deg);
          opacity: 0;
        }

        1% {
          opacity: 1;
        }

        25% {
          transform: translateX(-3000%) translateY(3000%) rotate(-45deg);
          opacity: 1;
        }

        30% {
          transform: translateX(-3600%) translateY(3600%) rotate(-45deg);
          opacity: 0;
        }

        35% {
          transform: translateX(0) translateY(0) rotate(-45deg);
          opacity: 0;
        }
      }

      @keyframes breath {
        0%,
        100% {
          transform-origin: 0 100%;
          transform: scale(1) rotate(0);
        }

        50% {
          transform: scale(1.15) rotate(9deg);
        }
      }

      @keyframes rocket-tremble {
        0% {
          transform: translateY(0px) translateX(0px) rotate(0deg);
        }

        15% {
          transform: translateY(-1px) translateX(0.5px) rotate(0.3deg);
        }

        30% {
          transform: translateY(0.5px) translateX(-0.3px) rotate(-0.2deg);
        }

        45% {
          transform: translateY(-0.8px) translateX(0.7px) rotate(0.4deg);
        }

        60% {
          transform: translateY(1px) translateX(-0.5px) rotate(-0.3deg);
        }

        75% {
          transform: translateY(-0.5px) translateX(0.3px) rotate(0.2deg);
        }

        90% {
          transform: translateY(0.3px) translateX(-0.2px) rotate(-0.1deg);
        }

        100% {
          transform: translateY(0px) translateX(0px) rotate(0deg);
        }
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
        }

        50% {
          opacity: 1;
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes slide {
        0% {
          transform: translateX(-20px);
        }

        100% {
          transform: translateX(0);
        }
      }

      /* 响应式媒体查询 */
      @media (max-width: 768px) {
        body {
          padding: 0;
        }

        .container {
          margin: 0;
          border-radius: 0;
          padding-bottom: 10px;
        }

        .main-content {
          flex-direction: column;
          min-height: auto;
        }

        .left-panel {
          max-width: 100%;
          border-right: none;
          border-bottom: 4px solid #e0e0e0;
        }

        .right-panel {
          max-width: 100%;
          flex-direction: column;
        }

        .icon-clear,
        .icon-complete {
          background: none !important;
        }

        .textarea-container textarea {
          min-height: 150px;
          max-height: 80vh;
        }

        .checkbox-container {
          max-height: 164px;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .empty-state {
          height: auto;
        }

        .result-content.full {
          min-height: calc(100vh - 40px - 38px - 5px);
          max-height: calc(100vh - 40px - 38px - 5px);
        }

        .result-content.fold {
          max-height: 0 !important;
          min-height: 0 !important;
          padding-top: 0;
          border-top: none;
          overflow: hidden;
        }

        .area:has(.fold) .section-header {
          padding-bottom: 0;
          margin-bottom: 0;
        }
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="container">
        <div class="header">
          <h1>
            <span class="rocket" @click="showHelp()">🚀</span>
            <span>提示词优化器</span>
            <small class="icon-history" @click="showHistory()">💭</small>
          </h1>
          <p>智能评估和优化您的AI提示词，问得更好，问出水平</p>
          <div class="stars">
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
            <div>
              <div class="meteor"></div>
              <div class="meteor"></div>
              <div class="meteor"></div>
            </div>
          </div>
        </div>

        <div class="main-content">
          <!-- 区域1: 输入和控制区域 -->
          <div class="left-panel">
            <div class="textarea-container">
              <label for="prompt-input"
                ><strong>✍️ 请输入您的原始提示词：</strong></label
              >
              <textarea
                id="prompt-input"
                v-model="promptText"
                :class="{completing: isCompleting}"
                maxlength="5000"
                :readonly="isCompleting"
                placeholder="在这里输入您想要优化的提示词（5~5000字）"
                @change="saveCache()"
                @input="saveCache()"
              ></textarea>
              <span class="icons" v-cloak>
                <span
                  v-if="canUndoPrompt"
                  class="icon-undo"
                  title="撤销润色"
                  @click="undoPrompt"
                  >↩️</span
                >
                <span
                  v-if="prompt.length >= 5 && prompt.length <= 120"
                  class="icon-complete"
                  :class="{busy: isCompleting}"
                  title="润色"
                  @click="quickComplete()"
                  >✨</span
                >
                <span
                  v-if="prompt.length"
                  class="icon-clear"
                  title="清空"
                  @click="clearPrompt()"
                  >❌</span
                >
              </span>
            </div>

            <div class="checkbox-group">
              <h3>
                <span>📋 评估维度选择</span>
                <small>
                  <a href="javascript:void(0)" @click="selectAllDimensions()"
                    >全选</a
                  >
                  <span>&nbsp;/&nbsp;</span>
                  <a href="javascript:void(0)" @click="deselectAllDimensions()"
                    >全不选</a
                  >
                </small>
              </h3>
              <div class="checkbox-container" v-cloak>
                <div
                  class="checkbox-item"
                  v-for="dimension in allDimensions"
                  :key="dimension.value"
                  :title="dimension.value"
                >
                  <input
                    type="checkbox"
                    :id="dimension.value"
                    :value="dimension.value"
                    v-model="selectedDimensions"
                    @change="saveCache()"
                  />
                  <label :for="dimension.value">{{ dimension.label }}</label>
                </div>
                <!-- 自定义维度输入框 -->
                <div class="checkbox-item custom-dimension-item">
                  <input
                    type="checkbox"
                    id="custom-dimension-checkbox"
                    :checked="customDimension.trim().length > 0"
                    @change="toggleCustomDimension"
                  />
                  <input
                    type="text"
                    id="custom-dimension-input"
                    v-model="customDimension"
                    maxlength="50"
                    placeholder="输入自定义评估维度 (Better in English)"
                    @input="saveCache()"
                    @change="saveCache()"
                    class="custom-dimension-input"
                  />
                </div>
              </div>
            </div>

            <div class="button-group" v-cloak>
              <button
                class="btn btn-primary"
                :class="{disabled: isEvaluating || isOptimizing || !prompt || !selectedDimensions.length && !customDimension.trim()}"
                @click="executeEvaluation()"
              >
                <span v-if="isEvaluating" class="loading"></span>
                {{ isEvaluating ? '评估中...' : '🔍 执行评估' }}
              </button>

              <button
                class="btn btn-secondary"
                :class="{disabled: isEvaluating || isOptimizing || !prompt || !evaluationResult}"
                @click="executeOptimization()"
              >
                <span v-if="isOptimizing" class="loading"></span>
                {{ isOptimizing ? '优化中...' : '⚡ 执行优化' }}
              </button>

              <button
                v-if="!isEvaluating && !isOptimizing && (optimizationResult || prompt.length > 120)"
                class="btn btn-default"
                @click="goToAskAi()"
              >
                <span>👋 去问AI吧</span>
              </button>
            </div>
          </div>

          <div class="right-panel">
            <!-- 区域2: 评估结果展示 -->
            <div class="area result-area">
              <div class="section-header">
                <h2 class="section-title">
                  <span>📊 评估报告</span>
                  <small v-if="canFoldEvaluation" v-cloak>
                    &nbsp;
                    <a
                      href="javascript:void(0)"
                      @click="toggleFold('Evaluation')"
                      >{{ isFoldEvaluation ? '展开' : '收起' }}</a
                    >
                  </small>
                </h2>
                <span>
                  <button
                    v-if="evaluationResult"
                    class="clear-btn"
                    v-cloak
                    @click="clearResult('evaluationResult')"
                  >
                    ❌ 清空
                  </button>
                  <button
                    v-if="evaluationResult"
                    class="copy-btn"
                    v-cloak
                    @click="copyToClipboard('evaluationResult')"
                  >
                    📋 复制：评估报告
                  </button>
                </span>
              </div>
              <div
                class="result-content"
                :class="{full: evaluationResult, fold: isMobile && evaluationResult && isFoldEvaluation}"
              >
                <div
                  v-if="evaluationResult"
                  class="markdown-body"
                  v-html="evaluationResultHtml"
                ></div>
                <div
                  v-else
                  class="empty-state"
                  :class="{generating: isEvaluating}"
                  v-cloak
                >
                  <span
                    >{{ !isEvaluating ? '' : '正在评估... '
                    }}评估报告将在这里显示...{{ !isEvaluating ? '' :
                    '\n用时约25~40秒，请耐心等候...' }}
                  </span>
                </div>
              </div>
            </div>

            <!-- 区域3: 优化结果展示 -->
            <div class="area optimization-area">
              <div class="section-header">
                <h2 class="section-title">
                  <span>✨ 优化结果</span>
                  <small v-if="canFoldOptimization" v-cloak>
                    &nbsp;
                    <a
                      href="javascript:void(0)"
                      @click="toggleFold('Optimization')"
                      >{{ isFoldOptimization ? '展开' : '收起' }}</a
                    >
                  </small>
                </h2>
                <span>
                  <button
                    v-if="optimizationResult"
                    class="clear-btn"
                    v-cloak
                    @click="clearResult('optimizationResult')"
                  >
                    ❌ 清空
                  </button>
                  <button
                    v-if="optimizationResult"
                    class="copy-btn"
                    v-cloak
                    @click="copyToClipboard('optimizationResult')"
                  >
                    📋 复制最终提示词
                  </button>
                </span>
              </div>
              <div
                class="result-content"
                :class="{full: optimizationResult, fold: isMobile && optimizationResult && isFoldOptimization}"
              >
                <div
                  v-if="optimizationResult"
                  class="markdown-body"
                  v-html="optimizationResultHtml"
                ></div>
                <div
                  v-else
                  class="empty-state"
                  :class="{generating: isOptimizing}"
                  v-cloak
                >
                  <span
                    >{{ !isOptimizing ? '' : '正在优化... '
                    }}优化结果将在这里显示...{{ !isOptimizing ? '' :
                    '\n用时约35秒，请耐心等候...' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 引入JS库 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/sweetalert2@11"></script>
    <script src="https://unpkg.com/showdown/dist/showdown.min.js"></script>

    <script>
      const { createApp } = Vue;

      window.app = createApp({
        data() {
          return {
            promptText: '',
            selectedDimensions: [],
            evaluationResult: '',
            optimizationResult: '',
            isCompleting: false,
            isEvaluating: false,
            isOptimizing: false,
            allDimensions: [
              {
                value: 'Clarity & Specificity',
                label: '清晰度与具体性'
              },
              {
                value: 'Context / Background Provided',
                label: '上下文/背景信息提供'
              },
              {
                value: 'Explicit Task Definition',
                label: '明确的任务定义'
              },
              {
                value: 'Feasibility within Model Constraints',
                label: '模型能力范围内的可行性'
              },
              {
                value: 'Avoiding Ambiguity or Contradictions',
                label: '避免模糊性或内在矛盾'
              },
              {
                value: 'Model Fit / Scenario Appropriateness',
                label: '模型适配性/场景适用性'
              },
              {
                value: 'Desired Output Format / Style',
                label: '期望的输出格式/风格'
              },
              {
                value: 'Use of Role or Persona',
                label: '角色设定'
              },
              {
                value: 'Step-by-Step Reasoning Encouraged',
                label: '鼓励进行分步推理'
              },
              {
                value: 'Structured / Numbered Instructions',
                label: '结构化/编号指令'
              },
              {
                value: 'Brevity vs. Detail Balance',
                label: '简洁与详细的平衡'
              },
              {
                value: 'Iteration / Refinement Potential',
                label: '迭代/优化潜力'
              },
              {
                value: 'Examples or Demonstrations',
                label: '提供示例或演示'
              },
              {
                value: 'Handling Uncertainty / Gaps',
                label: '处理不确定性/信息空白'
              },
              {
                value: 'Hallucination Minimization',
                label: '最小化"幻觉"现象'
              },
              {
                value: 'Knowledge Boundary Awareness',
                label: '知识边界意识'
              },
              {
                value: 'Audience Specification',
                label: '明确目标受众'
              },
              {
                value: 'Style Emulation or Imitation',
                label: '风格模拟或模仿'
              },
              {
                value: 'Memory Anchoring (Multi-Turn Systems)',
                label: '记忆锚定(用于多轮对话)'
              },
              {
                value: 'Meta-Cognition Triggers',
                label: '元认知触发(引导模型反思)'
              },
              {
                value: 'Divergent vs. Convergent Thinking Management',
                label: '发散性/收敛性思维管理'
              },
              {
                value: 'Hypothetical Frame Switching',
                label: '假设性框架切换'
              },
              {
                value: 'Safe Failure Mode',
                label: '安全的失败模式设计'
              },
              {
                value: 'Progressive Complexity',
                label: '渐进式增加复杂性'
              },
              {
                value: 'Alignment with Evaluation Metrics',
                label: '与评估指标对齐'
              },
              {
                value: 'Calibration Requests',
                label: '(对输出的)校准请求'
              },
              {
                value: 'Output Validation Hooks',
                label: '输出验证挂钩/机制'
              },
              {
                value: 'Time/Effort Estimation Request',
                label: '时间/精力消耗预估请求'
              },
              {
                value: 'Ethical Alignment or Bias Mitigation',
                label: '伦理对齐或偏见缓解'
              },
              {
                value: 'Limitations Disclosure',
                label: '局限性披露'
              },
              {
                value: 'Compression / Summarization Ability',
                label: '压缩/摘要能力'
              },
              {
                value: 'Cross-Disciplinary Bridging',
                label: '跨学科知识桥接'
              },
              {
                value: 'Emotional Resonance Calibration',
                label: '情感共鸣校准'
              },
              {
                value: 'Output Risk Categorization',
                label: '输出内容的风险分类'
              },
              {
                value: 'Self-Repair Loops',
                label: '自我修复循环'
              }
            ],
            userAgent: window.navigator.userAgent,
            isFoldEvaluation: false,
            isFoldOptimization: false,
            __previousPrompt: '',
            __lastCompletePrompt: '',
            customDimension: ''
          };
        },
        computed: {
          prompt() {
            return (this.promptText || '').trim();
          },
          evaluationResultHtml() {
            if (!this.evaluationResult) return '';
            const converter = new showdown.Converter();
            converter.setOption('simpleLineBreaks', true);
            converter.setOption('simplifiedAutoLink', false);
            converter.setOption('excludeTrailingPunctuationFromURLs', true);
            converter.setOption('literalMidWordUnderscores', true);
            converter.setOption('strikethrough', true);
            converter.setOption('tasklists', true);
            converter.setOption('tables', true);
            const str = this.evaluationResult
              .replace(/\\\\n/g, '\n')
              .replace(/\\n/g, '\n');
            return converter.makeHtml(str);
          },
          optimizationResultHtml() {
            if (!this.optimizationResult) return '';
            const converter = new showdown.Converter();
            converter.setOption('simpleLineBreaks', true);
            converter.setOption('simplifiedAutoLink', false);
            converter.setOption('excludeTrailingPunctuationFromURLs', true);
            converter.setOption('literalMidWordUnderscores', true);
            converter.setOption('strikethrough', true);
            converter.setOption('tasklists', true);
            converter.setOption('tables', true);
            const str = this.optimizationResult
              .replace(/\\\\n/g, '\n')
              .replace(/\\n/g, '\n');
            return converter.makeHtml(str);
          },
          isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
              this.userAgent
            );
          },
          canUndoPrompt() {
            return (
              this.__previousPrompt &&
              this.__lastCompletePrompt &&
              this.promptText === this.__lastCompletePrompt
            );
          },
          canFoldEvaluation() {
            if (!this.isMobile) return false;
            if (this.isEvaluating || !this.evaluationResult) return false;
            return true;
          },
          canFoldOptimization() {
            if (!this.isMobile) return false;
            if (this.isOptimizing || !this.optimizationResult) return false;
            return true;
          }
        },
        methods: {
          warn(
            text,
            title = '提示',
            icon = 'warning',
            confirmButtonText = '确定'
          ) {
            return Swal.fire({
              title,
              text,
              icon,
              confirmButtonText
            });
          },
          success(text, title = '成功', timer = 1500) {
            return Swal.fire({
              icon: 'success',
              title,
              text,
              timer,
              showConfirmButton: false
            });
          },
          info(text, title = null, icon = 'info') {
            return Swal.fire({
              icon,
              title,
              text,
              confirmButtonText: '确定'
            });
          },
          confirm(
            text,
            title = '请确认',
            icon = 'question',
            confirmButtonText = '确认',
            cancelButtonText = '取消'
          ) {
            return Swal.fire({
              title,
              text,
              icon,
              confirmButtonText,
              cancelButtonText,
              showCancelButton: true,
              reverseButtons: true
            }).then(res => {
              if (res.isConfirmed) {
                return true;
              } else {
                return false;
              }
            });
          },
          showHelp(isAuto = false) {
            if (isAuto) {
              // 检查今日是否已经点过"今日不再弹出"
              const today = new Date().toDateString();
              const noShowToday = localStorage.getItem('hasViewPromptReadme');
              if (noShowToday === today) return;
            }
            Swal.fire({
              title: null,
              icon: this.isMobile ? null : 'info',
              html: `<div class="markdown-body" style="text-align: left"><p><strong>各位 AI 玩家请注意，我的"提示词优化器"新鲜出炉了！</strong></p>
      <p><small>整个项目跑在一个 FastAPI 后端里，前端通过Vue.js构建，主打一个轻量高效。</small></p>
      <p>快来试试这两种"炼丹"模式：</p>
      <ol><li>
      专家诊断书 👨‍⚕️：<br>
      想知道你的提示词"病"在哪吗？提交你的提示词，勾选几个你关心的维度，【执行评估】，AI模型会给你一份专业的"体检报告"，告诉你从哪下手改进。
      </li>
      <li>
      究极超进化 🚀：<br>
      准备好见证奇迹了吗？将提示词和上面的"体检报告"一起提交，【执行优化】，AI模型会为你打造出一个"完全体"的超级提示词！拿着它去"拷问" AI，看看回答质量是不是原地起飞！</li></ol>
      <p><small>（点击页面顶部的 🚀 和 💭 图标分别可以查看 <i>帮助信息</i> 和 <i>历史记录</i>）</small></p>
      </div>`,
              width: this.isMobile ? null : '570px',
              padding: this.isMobile ? '6px 0 10px' : null,
              inputAutoFocus: false,
              showCloseButton: false,
              showCancelButton: true,
              showConfirmButton: true,
              focusConfirm: false,
              cancelButtonText: '今日不再弹出',
              confirmButtonText: '我知道了',
              reverseButtons: true
            }).then(result => {
              if (
                result.isDismissed &&
                result.dismiss === Swal.DismissReason.cancel
              ) {
                // 用户点击了"今日不再弹出"
                const today = new Date().toDateString();
                localStorage.setItem('hasViewPromptReadme', today);
              }
            });
          },
          showHistory() {
            const historyList = this.loadHistory();
            let historyHtml = `<br><p>这里记录了您优化过的提示词，${
              this.isMobile ? '<br>' : ''
            }至多保留最近的30条。</p><div style="position: relative; max-height: 50vh; overflow: auto;"
                ><table
                  style="position: relative;">
                    <colgroup style="width: 7em"></colgroup>
                    <colgroup style="max-width: 22em"></colgroup>
                    <colgroup style="width: 4em"></colgroup>
                    <thead>
                      <tr>
                        <th>日期</th>
                        <th>提示词</th>
                        <th>操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${historyList
                        .map(i => {
                          return (
                            '<tr><td style="white-space: nowrap;">' +
                            new Date(i.time).toLocaleDateString() +
                            '</td><td><div class="ellipsis2">' +
                            i.promptText.slice(0, 120) +
                            '</div></td><td><a href="javascript:void(0)" data-restore>还原</a><br><a href="javascript:void(0)" data-delete style="display: inline-block; margin-top: 0.28em; color: #c00;">删除</a></td>'
                          );
                        })
                        .join('')}
                    </tbody>
                  </table></div><hr>`;
            if (!historyList.length) historyHtml = '<br>';
            const dialog = Swal.fire({
              title: null,
              icon: null,
              width: this.isMobile ? null : '38.5em',
              html: `${historyHtml}<small>created by FastAPI + Vue.js</small><br><small>2025/1/15</small><br><br><small>公益行为，请合理使用，感谢！</small>`,
              inputAutoFocus: false,
              showCloseButton: false,
              showCancelButton: false,
              focusConfirm: false,
              confirmButtonText: '&emsp;OK&emsp;',
              customClass: {
                htmlContainer: 'history-container markdown-body'
              }
            });
            const bindEvent = () => {
              const list = this.loadHistory();
              const btnsRestore = [
                ...document.querySelectorAll(
                  '.history-container table td a[data-restore]'
                )
              ];
              const btnsDelete = [
                ...document.querySelectorAll(
                  '.history-container table td a[data-delete]'
                )
              ];
              btnsRestore.forEach((btn, index) => {
                btn.onclick = () => {
                  const history = historyList[index];
                  for (const k in history) {
                    this[k] = history[k];
                  }
                  dialog.close();
                  this.saveCache();
                };
              });
              btnsDelete.forEach((btn, index) => {
                btn.onclick = () => {
                  list.splice(index, 1);
                  localStorage.setItem('promptHistory', JSON.stringify(list));
                  btn.closest('tr').remove();
                  bindEvent();
                };
              });
            };
            setTimeout(() => bindEvent(), 0);
          },
          // 维度全选
          selectAllDimensions() {
            this.selectedDimensions = this.allDimensions.map(i => i.value);
            this.saveCache();
          },
          // 维度全不选
          deselectAllDimensions() {
            this.selectedDimensions = [];
            this.saveCache();
          },
          // 切换自定义维度
          toggleCustomDimension(event) {
            if (!event.target.checked) {
              this.customDimension = '';
              this.saveCache();
            }
          },
          async quickComplete() {
            // 快速补全功能暂时禁用，因为后端没有对应接口
            this.warn('快速补全功能暂未实现，请使用评估和优化功能');
          },
          undoPrompt() {
            if (!this.canUndoPrompt) return;
            this.promptText = this.__previousPrompt;
            this.__previousPrompt = '';
            this.__lastCompletePrompt = '';
            this.saveCache();
          },
          async executeEvaluation() {
            if (this.validate('evaluate') !== true) return;
            const prompt = this.prompt;
            if (this.isEvaluating) return;
            this.isEvaluating = true;
            this.evaluationResult = '';
            this.isFoldEvaluation = false;
            // 合并固定维度和自定义维度
            let allDimensions = [...this.selectedDimensions];
            if (this.customDimension.trim()) {
              allDimensions.push(this.customDimension.trim());
            }
            const params = {
              prompt_content: prompt,
              dimensions: allDimensions
            };
            const data = await this.apiCall('/api/prompt_evaluation', params);
            this.isEvaluating = false;
            if (!data) return;
            this.success('已生成评估报告！', '成功', 2500);
            this.evaluationResult = data.evaluation_result || '';
            this.isFoldEvaluation = false;
            this.saveCache();
          },
          async executeOptimization() {
            if (this.validate('optimize') !== true) return;
            const prompt = this.prompt;
            if (prompt.length < 5) return this.warn('提示词内容过短！');
            if (prompt.length > 5000) return this.warn('提示词内容过长！');
            if (!this.evaluationResult) return this.warn('请先执行评估！');
            if (this.isOptimizing) return;
            this.isOptimizing = true;
            this.optimizationResult = '';
            this.isFoldOptimization = false;
            const params = {
              prompt_content: prompt,
              evaluation_result: this.evaluationResult
            };
            const data = await this.apiCall('/api/prompt_refinement', params);
            this.isOptimizing = false;
            if (!data) return;
            this.success('已完成提示词优化！', '成功', 2500);
            this.optimizationResult = data.refinement_result || '';
            this.isFoldOptimization = false;
            this.saveCache();
            this.saveHistory();
          },
          apiCall(url, data) {
            const headers = { 'Content-Type': 'application/json' };
            data = JSON.stringify(data);
            return fetch(url, {
              method: 'POST',
              headers,
              body: data
            })
              .then(res => {
                return res.json();
              })
              .then(json => {
                if (json.detail) {
                  this.warn(
                    json.detail || '接口调用失败！',
                    '错误',
                    'error'
                  );
                  return null;
                }
                return json;
              })
              .catch(e => {
                console.error(e);
                this.warn('接口调用失败！', '错误', 'error');
                return null;
              });
          },
          saveCache() {
            if (this.promptText.length > 5000) {
              this.promptText = this.promptText.slice(0, 5000);
            }
            const promptCache = {
              promptText: this.prompt || '',
              __previousPrompt: this.__previousPrompt || '',
              __lastCompletePrompt: this.__lastCompletePrompt || '',
              selectedDimensions: this.selectedDimensions,
              customDimension: this.customDimension || '',
              evaluationResult: this.evaluationResult || '',
              optimizationResult: this.optimizationResult || ''
            };
            localStorage.setItem('promptCache', JSON.stringify(promptCache));
          },
          loadCache() {
            let cache = localStorage.getItem('promptCache');
            if (!cache) return;
            cache = JSON.parse(cache);
            for (const k in cache) {
              let val = cache[k];
              // 校验一下selectedDimensions数组,并保证按固定的次序排列
              if (k === 'selectedDimensions') {
                val = (val || []).filter(i =>
                  this.allDimensions.some(d => d.value === i)
                );
              }
              this[k] = val;
            }
          },
          saveHistory() {
            const {
              promptText,
              selectedDimensions,
              customDimension,
              evaluationResult,
              optimizationResult
            } = this;
            let historyList = this.loadHistory();
            historyList.unshift({
              time: Date.now(),
              promptText,
              selectedDimensions,
              customDimension,
              evaluationResult,
              optimizationResult
            });
            historyList = historyList.slice(0, 30);
            localStorage.setItem('promptHistory', JSON.stringify(historyList));
          },
          loadHistory() {
            let historyList = [];
            try {
              const str = localStorage.getItem('promptHistory') || '[]';
              historyList = JSON.parse(str);
            } catch (e) {}
            return historyList;
          },
          clearHistory() {
            localStorage.removeItem('promptHistory');
          },
          async clearPrompt() {
            const doClear = () => {
              this.promptText = '';
              this.saveCache();
            };
            if (this.prompt.length <= 10) {
              return doClear();
            }
            const isConfirmed = await this.confirm('确认要清空原始提示词吗？');
            if (isConfirmed) {
              doClear();
            }
          },
          async clearResult(key) {
            const name = key === 'evaluationResult' ? '评估报告' : '优化结果';
            const isConfirmed = await this.confirm(`确认要清空${name}吗？`);
            if (isConfirmed) {
              this[key] = '';
              this.saveCache();
            }
          },
          toggleFold(type) {
            const key = `isFold${type}`;
            this[key] = !this[key];
          },
          async copyToClipboard(key) {
            if (key === 'evaluationResult') {
              try {
                await navigator.clipboard.writeText(
                  this.evaluationResult.trim()
                );
                this.success('评估报告已复制到剪贴板！', '复制成功');
              } catch (error) {
                console.error('复制失败:', error);
                this.warn(
                  '无法复制到剪贴板，请手动复制！',
                  '复制失败',
                  'error'
                );
              }
            }
            if (key === 'optimizationResult') {
              const code = document.querySelector(
                '.optimization-area pre code'
              );
              try {
                await navigator.clipboard.writeText(code.innerText.trim());
                this.success('优化后的提示词已复制到剪贴板！', '复制成功');
              } catch (error) {
                console.error('复制失败:', error);
                this.warn(
                  '无法复制到剪贴板，请手动复制！',
                  '复制失败',
                  'error'
                );
              }
            }
          },
          validate(key) {
            if (key === 'evaluate') {
              if (!this.prompt.length) return this.warn('请输入提示词！');
              if (this.prompt.length < 5) return this.warn('提示词内容过短！');
              if (this.prompt.length > 5000)
                return this.warn('提示词内容过长！');
              if (
                this.selectedDimensions.length < 1 &&
                !this.customDimension.trim()
              )
                return this.warn('请至少选择1个评估维度或输入自定义维度！');
              if (this.isEvaluating)
                return this.warn('正在执行评估，请稍候...');
              if (this.isOptimizing)
                return this.warn('正在执行优化，请等待执行完成...');
            }
            if (key === 'optimize') {
              if (this.isOptimizing)
                return this.warn('正在执行优化，请稍候...');
              if (this.isEvaluating)
                return this.warn('评估正在执行中，请先完成评估！');
              if (!this.evaluationResult) return this.warn('请先执行评估！');
              if (!this.prompt.length) return this.warn('请输入提示词！');
              if (this.prompt.length < 5) return this.warn('提示词内容过短！');
              if (this.prompt.length > 5000)
                return this.warn('提示词内容过长！');
            }
            return true;
          },
          goToAskAi() {
            // window.open('https://chat.deepseek.com/');
            window.open('https://lmarena.ai/');
            // window.open('https://ai.dangbei.com/chat');
          }
        },
        mounted() {
          // 初始化时默认选择一些维度
          this.selectedDimensions = this.allDimensions
            .slice(0, 8)
            .map(i => i.value);
          // 加载表单缓存
          this.loadCache();
          // mounted时自动显示帮助（根据今日不再弹出设置判断）
          this.showHelp(true);
          // resize事件监听
          window.addEventListener('resize', () => {
            this.userAgent = window.navigator.userAgent;
          });
        }
      }).mount('#app');
    </script>
  </body>
</html>